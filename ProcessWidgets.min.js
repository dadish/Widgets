(function(){var e,t,n;(function(r){function v(e,t){return h.call(e,t)}function m(e,t){var n,r,i,s,o,u,a,f,c,h,p,v=t&&t.split("/"),m=l.map,g=m&&m["*"]||{};if(e&&e.charAt(0)===".")if(t){e=e.split("/"),o=e.length-1,l.nodeIdCompat&&d.test(e[o])&&(e[o]=e[o].replace(d,"")),e=v.slice(0,v.length-1).concat(e);for(c=0;c<e.length;c+=1){p=e[c];if(p===".")e.splice(c,1),c-=1;else if(p===".."){if(c===1&&(e[2]===".."||e[0]===".."))break;c>0&&(e.splice(c-1,2),c-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((v||g)&&m){n=e.split("/");for(c=n.length;c>0;c-=1){r=n.slice(0,c).join("/");if(v)for(h=v.length;h>0;h-=1){i=m[v.slice(0,h).join("/")];if(i){i=i[r];if(i){s=i,u=c;break}}}if(s)break;!a&&g&&g[r]&&(a=g[r],f=c)}!s&&a&&(s=a,u=f),s&&(n.splice(0,u,s),e=n.join("/"))}return e}function g(e,t){return function(){var n=p.call(arguments,0);return typeof n[0]!="string"&&n.length===1&&n.push(null),s.apply(r,n.concat([e,t]))}}function y(e){return function(t){return m(t,e)}}function b(e){return function(t){a[e]=t}}function w(e){if(v(f,e)){var t=f[e];delete f[e],c[e]=!0,i.apply(r,t)}if(!v(a,e)&&!v(c,e))throw new Error("No "+e);return a[e]}function E(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function S(e){return function(){return l&&l.config&&l.config[e]||{}}}var i,s,o,u,a={},f={},l={},c={},h=Object.prototype.hasOwnProperty,p=[].slice,d=/\.js$/;o=function(e,t){var n,r=E(e),i=r[0];return e=r[1],i&&(i=m(i,t),n=w(i)),i?n&&n.normalize?e=n.normalize(e,y(t)):e=m(e,t):(e=m(e,t),r=E(e),i=r[0],e=r[1],i&&(n=w(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},u={require:function(e){return g(e)},exports:function(e){var t=a[e];return typeof t!="undefined"?t:a[e]={}},module:function(e){return{id:e,uri:"",exports:a[e],config:S(e)}}},i=function(e,t,n,i){var s,l,h,p,d,m=[],y=typeof n,E;i=i||e;if(y==="undefined"||y==="function"){t=!t.length&&n.length?["require","exports","module"]:t;for(d=0;d<t.length;d+=1){p=o(t[d],i),l=p.f;if(l==="require")m[d]=u.require(e);else if(l==="exports")m[d]=u.exports(e),E=!0;else if(l==="module")s=m[d]=u.module(e);else if(v(a,l)||v(f,l)||v(c,l))m[d]=w(l);else{if(!p.p)throw new Error(e+" missing "+l);p.p.load(p.n,g(i,!0),b(l),{}),m[d]=a[l]}}h=n?n.apply(a[e],m):undefined;if(e)if(s&&s.exports!==r&&s.exports!==a[e])a[e]=s.exports;else if(h!==r||!E)a[e]=h}else e&&(a[e]=n)},e=t=s=function(e,t,n,a,f){if(typeof e=="string")return u[e]?u[e](t):w(o(e,t).f);if(!e.splice){l=e,l.deps&&s(l.deps,l.callback);if(!t)return;t.splice?(e=t,t=n,n=null):e=r}return t=t||function(){},typeof n=="function"&&(n=a,a=f),a?i(r,e,t,n):setTimeout(function(){i(r,e,t,n)},4),s},s.config=function(e){return s(e)},e._defined=a,n=function(e,t,n){if(typeof e!="string")throw new Error("See almond README: incorrect module build, no module name");t.splice||(n=t,t=[]),!v(a,e)&&!v(f,e)&&(f[e]=[e,t,n])},n.amd={jQuery:!0}})(),n("deps/almond/almond",function(){}),n("js/polyfills",["require","exports","module"],function(e,t,n){String.prototype.trim||function(){var e=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;String.prototype.trim=function(){return this.replace(e,"")}}()}),n("jquery",["require","exports","module"],function(e,t,n){n.exports=$}),n("jqueryUI",["require","exports","module"],function(e,t,n){n.exports=$.ui}),function(){function T(e){function t(t,n,r,i,s,o){for(;s>=0&&s<o;s+=e){var u=i?i[s]:s;r=n(r,t[u],u,t)}return r}return function(n,r,i,s){r=m(r,s,4);var o=!x(n)&&v.keys(n),u=(o||n).length,a=e>0?0:u-1;return arguments.length<3&&(i=n[o?o[a]:a],a+=e),t(n,r,i,o,a,u)}}function k(e){return function(t,n,r){n=g(n,r);var i=S(t),s=e>0?0:i-1;for(;s>=0&&s<i;s+=e)if(n(t[s],s,t))return s;return-1}}function L(e,t,n){return function(r,i,s){var o=0,a=S(r);if(typeof s=="number")e>0?o=s>=0?s:Math.max(s+a,o):a=s>=0?Math.min(s+1,a):s+a+1;else if(n&&s&&a)return s=n(r,i),r[s]===i?s:-1;if(i!==i)return s=t(u.call(r,o,a),v.isNaN),s>=0?s+o:-1;for(s=e>0?o:a-1;s>=0&&s<a;s+=e)if(r[s]===i)return s;return-1}}function _(e,t){var n=M.length,r=e.constructor,s=v.isFunction(r)&&r.prototype||i,o="constructor";v.has(e,o)&&!v.contains(t,o)&&t.push(o);while(n--)o=M[n],o in e&&e[o]!==s[o]&&!v.contains(t,o)&&t.push(o)}var e=this,t=e._,r=Array.prototype,i=Object.prototype,s=Function.prototype,o=r.push,u=r.slice,a=i.toString,f=i.hasOwnProperty,l=Array.isArray,c=Object.keys,h=s.bind,p=Object.create,d=function(){},v=function(e){if(e instanceof v)return e;if(!(this instanceof v))return new v(e);this._wrapped=e};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=v),exports._=v):e._=v,v.VERSION="1.8.3";var m=function(e,t,n){if(t===void 0)return e;switch(n==null?3:n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)};case 4:return function(n,r,i,s){return e.call(t,n,r,i,s)}}return function(){return e.apply(t,arguments)}},g=function(e,t,n){return e==null?v.identity:v.isFunction(e)?m(e,t,n):v.isObject(e)?v.matcher(e):v.property(e)};v.iteratee=function(e,t){return g(e,t,Infinity)};var y=function(e,t){return function(n){var r=arguments.length;if(r<2||n==null)return n;for(var i=1;i<r;i++){var s=arguments[i],o=e(s),u=o.length;for(var a=0;a<u;a++){var f=o[a];if(!t||n[f]===void 0)n[f]=s[f]}}return n}},b=function(e){if(!v.isObject(e))return{};if(p)return p(e);d.prototype=e;var t=new d;return d.prototype=null,t},w=function(e){return function(t){return t==null?void 0:t[e]}},E=Math.pow(2,53)-1,S=w("length"),x=function(e){var t=S(e);return typeof t=="number"&&t>=0&&t<=E};v.each=v.forEach=function(e,t,n){t=m(t,n);var r,i;if(x(e))for(r=0,i=e.length;r<i;r++)t(e[r],r,e);else{var s=v.keys(e);for(r=0,i=s.length;r<i;r++)t(e[s[r]],s[r],e)}return e},v.map=v.collect=function(e,t,n){t=g(t,n);var r=!x(e)&&v.keys(e),i=(r||e).length,s=Array(i);for(var o=0;o<i;o++){var u=r?r[o]:o;s[o]=t(e[u],u,e)}return s},v.reduce=v.foldl=v.inject=T(1),v.reduceRight=v.foldr=T(-1),v.find=v.detect=function(e,t,n){var r;x(e)?r=v.findIndex(e,t,n):r=v.findKey(e,t,n);if(r!==void 0&&r!==-1)return e[r]},v.filter=v.select=function(e,t,n){var r=[];return t=g(t,n),v.each(e,function(e,n,i){t(e,n,i)&&r.push(e)}),r},v.reject=function(e,t,n){return v.filter(e,v.negate(g(t)),n)},v.every=v.all=function(e,t,n){t=g(t,n);var r=!x(e)&&v.keys(e),i=(r||e).length;for(var s=0;s<i;s++){var o=r?r[s]:s;if(!t(e[o],o,e))return!1}return!0},v.some=v.any=function(e,t,n){t=g(t,n);var r=!x(e)&&v.keys(e),i=(r||e).length;for(var s=0;s<i;s++){var o=r?r[s]:s;if(t(e[o],o,e))return!0}return!1},v.contains=v.includes=v.include=function(e,t,n,r){x(e)||(e=v.values(e));if(typeof n!="number"||r)n=0;return v.indexOf(e,t,n)>=0},v.invoke=function(e,t){var n=u.call(arguments,2),r=v.isFunction(t);return v.map(e,function(e){var i=r?t:e[t];return i==null?i:i.apply(e,n)})},v.pluck=function(e,t){return v.map(e,v.property(t))},v.where=function(e,t){return v.filter(e,v.matcher(t))},v.findWhere=function(e,t){return v.find(e,v.matcher(t))},v.max=function(e,t,n){var r=-Infinity,i=-Infinity,s,o;if(t==null&&e!=null){e=x(e)?e:v.values(e);for(var u=0,a=e.length;u<a;u++)s=e[u],s>r&&(r=s)}else t=g(t,n),v.each(e,function(e,n,s){o=t(e,n,s);if(o>i||o===-Infinity&&r===-Infinity)r=e,i=o});return r},v.min=function(e,t,n){var r=Infinity,i=Infinity,s,o;if(t==null&&e!=null){e=x(e)?e:v.values(e);for(var u=0,a=e.length;u<a;u++)s=e[u],s<r&&(r=s)}else t=g(t,n),v.each(e,function(e,n,s){o=t(e,n,s);if(o<i||o===Infinity&&r===Infinity)r=e,i=o});return r},v.shuffle=function(e){var t=x(e)?e:v.values(e),n=t.length,r=Array(n);for(var i=0,s;i<n;i++)s=v.random(0,i),s!==i&&(r[i]=r[s]),r[s]=t[i];return r},v.sample=function(e,t,n){return t==null||n?(x(e)||(e=v.values(e)),e[v.random(e.length-1)]):v.shuffle(e).slice(0,Math.max(0,t))},v.sortBy=function(e,t,n){return t=g(t,n),v.pluck(v.map(e,function(e,n,r){return{value:e,index:n,criteria:t(e,n,r)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0)return 1;if(n<r||r===void 0)return-1}return e.index-t.index}),"value")};var N=function(e){return function(t,n,r){var i={};return n=g(n,r),v.each(t,function(r,s){var o=n(r,s,t);e(i,r,o)}),i}};v.groupBy=N(function(e,t,n){v.has(e,n)?e[n].push(t):e[n]=[t]}),v.indexBy=N(function(e,t,n){e[n]=t}),v.countBy=N(function(e,t,n){v.has(e,n)?e[n]++:e[n]=1}),v.toArray=function(e){return e?v.isArray(e)?u.call(e):x(e)?v.map(e,v.identity):v.values(e):[]},v.size=function(e){return e==null?0:x(e)?e.length:v.keys(e).length},v.partition=function(e,t,n){t=g(t,n);var r=[],i=[];return v.each(e,function(e,n,s){(t(e,n,s)?r:i).push(e)}),[r,i]},v.first=v.head=v.take=function(e,t,n){return e==null?void 0:t==null||n?e[0]:v.initial(e,e.length-t)},v.initial=function(e,t,n){return u.call(e,0,Math.max(0,e.length-(t==null||n?1:t)))},v.last=function(e,t,n){return e==null?void 0:t==null||n?e[e.length-1]:v.rest(e,Math.max(0,e.length-t))},v.rest=v.tail=v.drop=function(e,t,n){return u.call(e,t==null||n?1:t)},v.compact=function(e){return v.filter(e,v.identity)};var C=function(e,t,n,r){var i=[],s=0;for(var o=r||0,u=S(e);o<u;o++){var a=e[o];if(x(a)&&(v.isArray(a)||v.isArguments(a))){t||(a=C(a,t,n));var f=0,l=a.length;i.length+=l;while(f<l)i[s++]=a[f++]}else n||(i[s++]=a)}return i};v.flatten=function(e,t){return C(e,t,!1)},v.without=function(e){return v.difference(e,u.call(arguments,1))},v.uniq=v.unique=function(e,t,n,r){v.isBoolean(t)||(r=n,n=t,t=!1),n!=null&&(n=g(n,r));var i=[],s=[];for(var o=0,u=S(e);o<u;o++){var a=e[o],f=n?n(a,o,e):a;t?((!o||s!==f)&&i.push(a),s=f):n?v.contains(s,f)||(s.push(f),i.push(a)):v.contains(i,a)||i.push(a)}return i},v.union=function(){return v.uniq(C(arguments,!0,!0))},v.intersection=function(e){var t=[],n=arguments.length;for(var r=0,i=S(e);r<i;r++){var s=e[r];if(v.contains(t,s))continue;for(var o=1;o<n;o++)if(!v.contains(arguments[o],s))break;o===n&&t.push(s)}return t},v.difference=function(e){var t=C(arguments,!0,!0,1);return v.filter(e,function(e){return!v.contains(t,e)})},v.zip=function(){return v.unzip(arguments)},v.unzip=function(e){var t=e&&v.max(e,S).length||0,n=Array(t);for(var r=0;r<t;r++)n[r]=v.pluck(e,r);return n},v.object=function(e,t){var n={};for(var r=0,i=S(e);r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},v.findIndex=k(1),v.findLastIndex=k(-1),v.sortedIndex=function(e,t,n,r){n=g(n,r,1);var i=n(t),s=0,o=S(e);while(s<o){var u=Math.floor((s+o)/2);n(e[u])<i?s=u+1:o=u}return s},v.indexOf=L(1,v.findIndex,v.sortedIndex),v.lastIndexOf=L(-1,v.findLastIndex),v.range=function(e,t,n){t==null&&(t=e||0,e=0),n=n||1;var r=Math.max(Math.ceil((t-e)/n),0),i=Array(r);for(var s=0;s<r;s++,e+=n)i[s]=e;return i};var A=function(e,t,n,r,i){if(r instanceof t){var s=b(e.prototype),o=e.apply(s,i);return v.isObject(o)?o:s}return e.apply(n,i)};v.bind=function(e,t){if(h&&e.bind===h)return h.apply(e,u.call(arguments,1));if(!v.isFunction(e))throw new TypeError("Bind must be called on a function");var n=u.call(arguments,2),r=function(){return A(e,r,t,this,n.concat(u.call(arguments)))};return r},v.partial=function(e){var t=u.call(arguments,1),n=function(){var r=0,i=t.length,s=Array(i);for(var o=0;o<i;o++)s[o]=t[o]===v?arguments[r++]:t[o];while(r<arguments.length)s.push(arguments[r++]);return A(e,n,this,this,s)};return n},v.bindAll=function(e){var t,n=arguments.length,r;if(n<=1)throw new Error("bindAll must be passed function names");for(t=1;t<n;t++)r=arguments[t],e[r]=v.bind(e[r],e);return e},v.memoize=function(e,t){var n=function(r){var i=n.cache,s=""+(t?t.apply(this,arguments):r);return v.has(i,s)||(i[s]=e.apply(this,arguments)),i[s]};return n.cache={},n},v.delay=function(e,t){var n=u.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},v.defer=v.partial(v.delay,v,1),v.throttle=function(e,t,n){var r,i,s,o=null,u=0;n||(n={});var a=function(){u=n.leading===!1?0:v.now(),o=null,s=e.apply(r,i),o||(r=i=null)};return function(){var f=v.now();!u&&n.leading===!1&&(u=f);var l=t-(f-u);return r=this,i=arguments,l<=0||l>t?(o&&(clearTimeout(o),o=null),u=f,s=e.apply(r,i),o||(r=i=null)):!o&&n.trailing!==!1&&(o=setTimeout(a,l)),s}},v.debounce=function(e,t,n){var r,i,s,o,u,a=function(){var f=v.now()-o;f<t&&f>=0?r=setTimeout(a,t-f):(r=null,n||(u=e.apply(s,i),r||(s=i=null)))};return function(){s=this,i=arguments,o=v.now();var f=n&&!r;return r||(r=setTimeout(a,t)),f&&(u=e.apply(s,i),s=i=null),u}},v.wrap=function(e,t){return v.partial(t,e)},v.negate=function(e){return function(){return!e.apply(this,arguments)}},v.compose=function(){var e=arguments,t=e.length-1;return function(){var n=t,r=e[t].apply(this,arguments);while(n--)r=e[n].call(this,r);return r}},v.after=function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},v.before=function(e,t){var n;return function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=null),n}},v.once=v.partial(v.before,2);var O=!{toString:null}.propertyIsEnumerable("toString"),M=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];v.keys=function(e){if(!v.isObject(e))return[];if(c)return c(e);var t=[];for(var n in e)v.has(e,n)&&t.push(n);return O&&_(e,t),t},v.allKeys=function(e){if(!v.isObject(e))return[];var t=[];for(var n in e)t.push(n);return O&&_(e,t),t},v.values=function(e){var t=v.keys(e),n=t.length,r=Array(n);for(var i=0;i<n;i++)r[i]=e[t[i]];return r},v.mapObject=function(e,t,n){t=g(t,n);var r=v.keys(e),i=r.length,s={},o;for(var u=0;u<i;u++)o=r[u],s[o]=t(e[o],o,e);return s},v.pairs=function(e){var t=v.keys(e),n=t.length,r=Array(n);for(var i=0;i<n;i++)r[i]=[t[i],e[t[i]]];return r},v.invert=function(e){var t={},n=v.keys(e);for(var r=0,i=n.length;r<i;r++)t[e[n[r]]]=n[r];return t},v.functions=v.methods=function(e){var t=[];for(var n in e)v.isFunction(e[n])&&t.push(n);return t.sort()},v.extend=y(v.allKeys),v.extendOwn=v.assign=y(v.keys),v.findKey=function(e,t,n){t=g(t,n);var r=v.keys(e),i;for(var s=0,o=r.length;s<o;s++){i=r[s];if(t(e[i],i,e))return i}},v.pick=function(e,t,n){var r={},i=e,s,o;if(i==null)return r;v.isFunction(t)?(o=v.allKeys(i),s=m(t,n)):(o=C(arguments,!1,!1,1),s=function(e,t,n){return t in n},i=Object(i));for(var u=0,a=o.length;u<a;u++){var f=o[u],l=i[f];s(l,f,i)&&(r[f]=l)}return r},v.omit=function(e,t,n){if(v.isFunction(t))t=v.negate(t);else{var r=v.map(C(arguments,!1,!1,1),String);t=function(e,t){return!v.contains(r,t)}}return v.pick(e,t,n)},v.defaults=y(v.allKeys,!0),v.create=function(e,t){var n=b(e);return t&&v.extendOwn(n,t),n},v.clone=function(e){return v.isObject(e)?v.isArray(e)?e.slice():v.extend({},e):e},v.tap=function(e,t){return t(e),e},v.isMatch=function(e,t){var n=v.keys(t),r=n.length;if(e==null)return!r;var i=Object(e);for(var s=0;s<r;s++){var o=n[s];if(t[o]!==i[o]||!(o in i))return!1}return!0};var D=function(e,t,n,r){if(e===t)return e!==0||1/e===1/t;if(e==null||t==null)return e===t;e instanceof v&&(e=e._wrapped),t instanceof v&&(t=t._wrapped);var i=a.call(e);if(i!==a.call(t))return!1;switch(i){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":if(+e!==+e)return+t!==+t;return+e===0?1/+e===1/t:+e===+t;case"[object Date]":case"[object Boolean]":return+e===+t}var s=i==="[object Array]";if(!s){if(typeof e!="object"||typeof t!="object")return!1;var o=e.constructor,u=t.constructor;if(o!==u&&!(v.isFunction(o)&&o instanceof o&&v.isFunction(u)&&u instanceof u)&&"constructor"in e&&"constructor"in t)return!1}n=n||[],r=r||[];var f=n.length;while(f--)if(n[f]===e)return r[f]===t;n.push(e),r.push(t);if(s){f=e.length;if(f!==t.length)return!1;while(f--)if(!D(e[f],t[f],n,r))return!1}else{var l=v.keys(e),c;f=l.length;if(v.keys(t).length!==f)return!1;while(f--){c=l[f];if(!v.has(t,c)||!D(e[c],t[c],n,r))return!1}}return n.pop(),r.pop(),!0};v.isEqual=function(e,t){return D(e,t)},v.isEmpty=function(e){return e==null?!0:x(e)&&(v.isArray(e)||v.isString(e)||v.isArguments(e))?e.length===0:v.keys(e).length===0},v.isElement=function(e){return!!e&&e.nodeType===1},v.isArray=l||function(e){return a.call(e)==="[object Array]"},v.isObject=function(e){var t=typeof e;return t==="function"||t==="object"&&!!e},v.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(e){v["is"+e]=function(t){return a.call(t)==="[object "+e+"]"}}),v.isArguments(arguments)||(v.isArguments=function(e){return v.has(e,"callee")}),typeof /./!="function"&&typeof Int8Array!="object"&&(v.isFunction=function(e){return typeof e=="function"||!1}),v.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},v.isNaN=function(e){return v.isNumber(e)&&e!==+e},v.isBoolean=function(e){return e===!0||e===!1||a.call(e)==="[object Boolean]"},v.isNull=function(e){return e===null},v.isUndefined=function(e){return e===void 0},v.has=function(e,t){return e!=null&&f.call(e,t)},v.noConflict=function(){return e._=t,this},v.identity=function(e){return e},v.constant=function(e){return function(){return e}},v.noop=function(){},v.property=w,v.propertyOf=function(e){return e==null?function(){}:function(t){return e[t]}},v.matcher=v.matches=function(e){return e=v.extendOwn({},e),function(t){return v.isMatch(t,e)}},v.times=function(e,t,n){var r=Array(Math.max(0,e));t=m(t,n,1);for(var i=0;i<e;i++)r[i]=t(i);return r},v.random=function(e,t){return t==null&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},v.now=Date.now||function(){return(new Date).getTime()};var P={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},H=v.invert(P),B=function(e){var t=function(t){return e[t]},n="(?:"+v.keys(e).join("|")+")",r=RegExp(n),i=RegExp(n,"g");return function(e){return e=e==null?"":""+e,r.test(e)?e.replace(i,t):e}};v.escape=B(P),v.unescape=B(H),v.result=function(e,t,n){var r=e==null?void 0:e[t];return r===void 0&&(r=n),v.isFunction(r)?r.call(e):r};var j=0;v.uniqueId=function(e){var t=++j+"";return e?e+t:t},v.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var F=/(.)^/,I={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},q=/\\|'|\r|\n|\u2028|\u2029/g,R=function(e){return"\\"+I[e]};v.template=function(e,t,n){!t&&n&&(t=n),t=v.defaults({},t,v.templateSettings);var r=RegExp([(t.escape||F).source,(t.interpolate||F).source,(t.evaluate||F).source].join("|")+"|$","g"),i=0,s="__p+='";e.replace(r,function(t,n,r,o,u){return s+=e.slice(i,u).replace(q,R),i=u+t.length,n?s+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":r?s+="'+\n((__t=("+r+"))==null?'':__t)+\n'":o&&(s+="';\n"+o+"\n__p+='"),t}),s+="';\n",t.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{var o=new Function(t.variable||"obj","_",s)}catch(u){throw u.source=s,u}var a=function(e){return o.call(this,e,v)},f=t.variable||"obj";return a.source="function("+f+"){\n"+s+"}",a},v.chain=function(e){var t=v(e);return t._chain=!0,t};var U=function(e,t){return e._chain?v(t).chain():t};v.mixin=function(e){v.each(v.functions(e),function(t){var n=v[t]=e[t];v.prototype[t]=function(){var e=[this._wrapped];return o.apply(e,arguments),U(this,n.apply(v,e))}})},v.mixin(v),v.each(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];v.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),(e==="shift"||e==="splice")&&n.length===0&&delete n[0],U(this,n)}}),v.each(["concat","join","slice"],function(e){var t=r[e];v.prototype[e]=function(){return U(this,t.apply(this._wrapped,arguments))}}),v.prototype.value=function(){return this._wrapped},v.prototype.valueOf=v.prototype.toJSON=v.prototype.value,v.prototype.toString=function(){return""+this._wrapped},typeof n=="function"&&n.amd&&n("underscore",[],function(){return v})}.call(this),function(e){var r=typeof self=="object"&&self.self==self&&self||typeof global=="object"&&global.global==global&&global;if(typeof n=="function"&&n.amd)n("backbone",["underscore","jquery","exports"],function(t,n,i){r.Backbone=e(r,i,t,n)});else if(typeof exports!="undefined"){var i=t("underscore"),s;try{s=t("jquery")}catch(o){}e(r,exports,i,s)}else r.Backbone=e(r,{},r._,r.jQuery||r.Zepto||r.ender||r.$)}(function(e,t,n,r){var i=e.Backbone,s=[],o=s.slice;t.VERSION="1.2.0",t.$=r,t.noConflict=function(){return e.Backbone=i,this},t.emulateHTTP=!1,t.emulateJSON=!1;var u=t.Events={},a=/\s+/,f=function(e,t,r,i,s){var o=0,u;if(r&&typeof r=="object")for(u=n.keys(r);o<u.length;o++)t=e(t,u[o],r[u[o]],s);else if(r&&a.test(r))for(u=r.split(a);o<u.length;o++)t=e(t,u[o],i,s);else t=e(t,r,i,s);return t};u.on=function(e,t,n){return l(this,e,t,n)};var l=function(e,t,n,r,i){e._events=f(c,e._events||{},t,n,{context:r,ctx:e,listening:i});if(i){var s=e._listeners||(e._listeners={});s[i.id]=i}return e};u.listenTo=function(e,t,r){if(!e)return this;var i=e._listenId||(e._listenId=n.uniqueId("l")),s=this._listeningTo||(this._listeningTo={}),o=s[i];if(!o){var u=this._listenId||(this._listenId=n.uniqueId("l"));o=s[i]={obj:e,objId:i,id:u,listeningTo:s,count:0}}return l(e,t,r,this,o),this};var c=function(e,t,n,r){if(n){var i=e[t]||(e[t]=[]),s=r.context,o=r.ctx,u=r.listening;u&&u.count++,i.push({callback:n,context:s,ctx:s||o,listening:u})}return e};u.off=function(e,t,n){return this._events?(this._events=f(h,this._events,e,t,{context:n,listeners:this._listeners}),this):this},u.stopListening=function(e,t,r){var i=this._listeningTo;if(!i)return this;var s=e?[e._listenId]:n.keys(i);for(var o=0;o<s.length;o++){var u=i[s[o]];if(!u)break;u.obj.off(t,r,this)}return n.isEmpty(i)&&(this._listeningTo=void 0),this};var h=function(e,t,r,i){if(!e)return;var s=0,o,u,a=i.context,f=i.listeners;if(!t&&!r&&!a){var l=n.keys(f);for(;s<l.length;s++)u=f[l[s]],delete f[u.id],delete u.listeningTo[u.objId];return}var c=t?[t]:n.keys(e);for(;s<c.length;s++){t=c[s];var h=e[t];if(!h)break;var p=[];for(var d=0;d<h.length;d++){var v=h[d];r&&r!==v.callback&&r!==v.callback._callback||a&&a!==v.context?p.push(v):(u=v.listening,u&&--u.count===0&&(delete f[u.id],delete u.listeningTo[u.objId]))}p.length?e[t]=p:delete e[t]}if(n.size(e))return e};u.once=function(e,t,r){var i=f(p,{},e,t,n.bind(this.off,this));return this.on(i,void 0,r)},u.listenToOnce=function(e,t,r){var i=f(p,{},t,r,n.bind(this.stopListening,this,e));return this.listenTo(e,i)};var p=function(e,t,r,i){if(r){var s=e[t]=n.once(function(){i(t,s),r.apply(this,arguments)});s._callback=r}return e};u.trigger=function(e){if(!this._events)return this;var t=Math.max(0,arguments.length-1),n=Array(t);for(var r=0;r<t;r++)n[r]=arguments[r+1];return f(d,this._events,e,void 0,n),this};var d=function(e,t,n,r){if(e){var i=e[t],s=e.all;i&&s&&(s=s.slice()),i&&v(i,r),s&&v(s,[t].concat(r))}return e},v=function(e,t){var n,r=-1,i=e.length,s=t[0],o=t[1],u=t[2];switch(t.length){case 0:while(++r<i)(n=e[r]).callback.call(n.ctx);return;case 1:while(++r<i)(n=e[r]).callback.call(n.ctx,s);return;case 2:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o);return;case 3:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o,u);return;default:while(++r<i)(n=e[r]).callback.apply(n.ctx,t);return}},m=function(e,t,r){switch(e){case 1:return function(){return n[t](this[r])};case 2:return function(e){return n[t](this[r],e)};case 3:return function(e,i){return n[t](this[r],e,i)};case 4:return function(e,i,s){return n[t](this[r],e,i,s)};default:return function(){var e=o.call(arguments);return e.unshift(this[r]),n[t].apply(n,e)}}},g=function(e,t,r){n.each(t,function(t,i){n[i]&&(e.prototype[i]=m(t,i,r))})};u.bind=u.on,u.unbind=u.off,n.extend(t,u);var y=t.Model=function(e,t){var r=e||{};t||(t={}),this.cid=n.uniqueId(this.cidPrefix),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(r=this.parse(r,t)||{}),r=n.defaults({},r,n.result(this,"defaults")),this.set(r,t),this.changed={},this.initialize.apply(this,arguments)};n.extend(y.prototype,u,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",initialize:function(){},toJSON:function(e){return n.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return n.escape(this.get(e))},has:function(e){return this.get(e)!=null},matches:function(e){return!!n.iteratee(e,this)(this.attributes)},set:function(e,t,r){var i,s,o,u,a,f,l,c;if(e==null)return this;typeof e=="object"?(s=e,r=t):(s={})[e]=t,r||(r={});if(!this._validate(s,r))return!1;o=r.unset,a=r.silent,u=[],f=this._changing,this._changing=!0,f||(this._previousAttributes=n.clone(this.attributes),this.changed={}),c=this.attributes,l=this._previousAttributes,this.idAttribute in s&&(this.id=s[this.idAttribute]);for(i in s)t=s[i],n.isEqual(c[i],t)||u.push(i),n.isEqual(l[i],t)?delete this.changed[i]:this.changed[i]=t,o?delete c[i]:c[i]=t;if(!a){u.length&&(this._pending=r);for(var h=0;h<u.length;h++)this.trigger("change:"+u[h],this,c[u[h]],r)}if(f)return this;if(!a)while(this._pending)r=this._pending,this._pending=!1,this.trigger("change",this,r);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,n.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var r in this.attributes)t[r]=void 0;return this.set(t,n.extend({},e,{unset:!0}))},hasChanged:function(e){return e==null?!n.isEmpty(this.changed):n.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?n.clone(this.changed):!1;var t,r=!1,i=this._changing?this._previousAttributes:this.attributes;for(var s in e){if(n.isEqual(i[s],t=e[s]))continue;(r||(r={}))[s]=t}return r},previous:function(e){return e==null||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return n.clone(this._previousAttributes)},fetch:function(e){e=e?n.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=this,r=e.success;return e.success=function(n){if(!t.set(t.parse(n,e),e))return!1;r&&r.call(e.context,t,n,e),t.trigger("sync",t,n,e)},q(this,e),this.sync("read",this,e)},save:function(e,t,r){var i,s,o,u=this.attributes,a;e==null||typeof e=="object"?(i=e,r=t):(i={})[e]=t,r=n.extend({validate:!0},r),a=r.wait;if(i&&!a){if(!this.set(i,r))return!1}else if(!this._validate(i,r))return!1;i&&a&&(this.attributes=n.extend({},u,i)),r.parse===void 0&&(r.parse=!0);var f=this,l=r.success;return r.success=function(e){f.attributes=u;var t=r.parse?f.parse(e,r):e;a&&(t=n.extend(i||{},t));if(n.isObject(t)&&!f.set(t,r))return!1;l&&l.call(r.context,f,e,r),f.trigger("sync",f,e,r)},q(this,r),s=this.isNew()?"create":r.patch?"patch":"update",s==="patch"&&!r.attrs&&(r.attrs=i),o=this.sync(s,this,r),i&&a&&(this.attributes=u),o},destroy:function(e){e=e?n.clone(e):{};var t=this,r=e.success,i=e.wait,s=function(){t.stopListening(),t.trigger("destroy",t,t.collection,e)};e.success=function(n){i&&s(),r&&r.call(e.context,t,n,e),t.isNew()||t.trigger("sync",t,n,e)};var o=!1;return this.isNew()?n.defer(e.success):(q(this,e),o=this.sync("delete",this,e)),i||s(),o},url:function(){var e=n.result(this,"urlRoot")||n.result(this.collection,"url")||I();if(this.isNew())return e;var t=this.id||this.attributes[this.idAttribute];return e.replace(/([^\/])$/,"$1/")+encodeURIComponent(t)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(e){return this._validate({},n.extend(e||{},{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=n.extend({},this.attributes,e);var r=this.validationError=this.validate(e,t)||null;return r?(this.trigger("invalid",this,r,n.extend(t,{validationError:r})),!1):!0}});var b={keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1};g(y,b,"attributes");var w=t.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),t.comparator!==void 0&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,n.extend({silent:!0},t))},E={add:!0,remove:!0,merge:!0},S={add:!0,remove:!1};n.extend(w.prototype,u,{model:y,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return t.sync.apply(this,arguments)},add:function(e,t){return this.set(e,n.extend({merge:!1},t,S))},remove:function(e,t){var r=!n.isArray(e),i;return e=r?[e]:n.clone(e),t||(t={}),i=this._removeModels(e,t),!t.silent&&i&&this.trigger("update",this,t),r?e[0]:e},set:function(e,t){t=n.defaults({},t,E),t.parse&&(e=this.parse(e,t));var r=!n.isArray(e);e=r?e?[e]:[]:e.slice();var i,s,o,u,a,f=t.at;f!=null&&(f=+f),f<0&&(f+=this.length+1);var l=this.comparator&&f==null&&t.sort!==!1,c=n.isString(this.comparator)?this.comparator:null,h=[],p=[],d={},v=t.add,m=t.merge,g=t.remove,y=!l&&v&&g?[]:!1,b=!1;for(var w=0;w<e.length;w++){o=e[w];if(u=this.get(o))g&&(d[u.cid]=!0),m&&o!==u&&(o=this._isModel(o)?o.attributes:o,t.parse&&(o=u.parse(o,t)),u.set(o,t),l&&!a&&u.hasChanged(c)&&(a=!0)),e[w]=u;else if(v){s=e[w]=this._prepareModel(o,t);if(!s)continue;h.push(s),this._addReference(s,t)}s=u||s;if(!s)continue;i=this.modelId(s.attributes),y&&(s.isNew()||!d[i])&&(y.push(s),b=b||!this.models[w]||s.cid!==this.models[w].cid),d[i]=!0}if(g){for(var w=0;w<this.length;w++)d[(s=this.models[w]).cid]||p.push(s);p.length&&this._removeModels(p,t)}if(h.length||b){l&&(a=!0),this.length+=h.length;if(f!=null)for(var w=0;w<h.length;w++)this.models.splice(f+w,0,h[w]);else{y&&(this.models.length=0);var S=y||h;for(var w=0;w<S.length;w++)this.models.push(S[w])}}a&&this.sort({silent:!0});if(!t.silent){var x=f!=null?n.clone(t):t;for(var w=0;w<h.length;w++)f!=null&&(x.index=f+w),(s=h[w]).trigger("add",s,this,x);(a||b)&&this.trigger("sort",this,t),(h.length||p.length)&&this.trigger("update",this,t)}return r?e[0]:e},reset:function(e,t){t=t?n.clone(t):{};for(var r=0;r<this.models.length;r++)this._removeReference(this.models[r],t);return t.previousModels=this.models,this._reset(),e=this.add(e,n.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,n.extend({at:this.length},t))},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return this.add(e,n.extend({at:0},t))},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(){return o.apply(this.models,arguments)},get:function(e){if(e==null)return void 0;var t=this.modelId(this._isModel(e)?e.attributes:e);return this._byId[e]||this._byId[t]||this._byId[e.cid]},at:function(e){return e<0&&(e+=this.length),this.models[e]},where:function(e,t){var r=n.matches(e);return this[t?"find":"filter"](function(e){return r(e.attributes)})},findWhere:function(e){return this.where(e,!0)},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return e||(e={}),n.isString(this.comparator)||this.comparator.length===1?this.models=this.sortBy(this.comparator,this):this.models.sort(n.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return n.invoke(this.models,"get",e)},fetch:function(e){e=e?n.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=e.success,r=this;return e.success=function(n){var i=e.reset?"reset":"set";r[i](n,e),t&&t.call(e.context,r,n,e),r.trigger("sync",r,n,e)},q(this,e),this.sync("read",this,e)},create:function(e,t){t=t?n.clone(t):{};var r=t.wait;if(!(e=this._prepareModel(e,t)))return!1;r||this.add(e,t);var i=this,s=t.success;return t.success=function(e,t,n){r&&i.add(e,n),s&&s.call(n.context,e,t,n)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(e){return e[this.model.prototype.idAttribute||"id"]},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(this._isModel(e))return e.collection||(e.collection=this),e;t=t?n.clone(t):{},t.collection=this;var r=new this.model(e,t);return r.validationError?(this.trigger("invalid",this,r.validationError,t),!1):r},_removeModels:function(e,t){var n,r,i,s,o=!1;for(var n=0,u=0;n<e.length;n++){var s=e[n]=this.get(e[n]);if(!s)continue;var a=this.modelId(s.attributes);a!=null&&delete this._byId[a],delete this._byId[s.cid];var i=this.indexOf(s);this.models.splice(i,1),this.length--,t.silent||(t.index=i,s.trigger("remove",s,this,t)),e[u++]=s,this._removeReference(s,t),o=!0}return e.length!==u&&(e=e.slice(0,u)),o},_isModel:function(e){return e instanceof y},_addReference:function(e,t){this._byId[e.cid]=e;var n=this.modelId(e.attributes);n!=null&&(this._byId[n]=e),e.on("all",this._onModelEvent,this)},_removeReference:function(e,t){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){if((e==="add"||e==="remove")&&n!==this)return;e==="destroy"&&this.remove(t,r);if(e==="change"){var i=this.modelId(t.previousAttributes()),s=this.modelId(t.attributes);i!==s&&(i!=null&&delete this._byId[i],s!=null&&(this._byId[s]=t))}this.trigger.apply(this,arguments)}});var x={forEach:3,each:3,map:3,collect:3,reduce:4,foldl:4,inject:4,reduceRight:4,foldr:4,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:2,contains:2,invoke:2,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3};g(w,x,"models");var T=["groupBy","countBy","sortBy","indexBy"];n.each(T,function(e){if(!n[e])return;w.prototype[e]=function(t,r){var i=n.isFunction(t)?t:function(e){return e.get(t)};return n[e](this.models,i,r)}});var N=t.View=function(e){this.cid=n.uniqueId("view"),e||(e={}),n.extend(this,n.pick(e,k)),this._ensureElement(),this.initialize.apply(this,arguments)},C=/^(\S+)\s*(.*)$/,k=["model","collection","el","id","attributes","className","tagName","events"];n.extend(N.prototype,u,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this._removeElement(),this.stopListening(),this},_removeElement:function(){this.$el.remove()},setElement:function(e){return this.undelegateEvents(),this._setElement(e),this.delegateEvents(),this},_setElement:function(e){this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0]},delegateEvents:function(e){if(!e&&!(e=n.result(this,"events")))return this;this.undelegateEvents();for(var t in e){var r=e[t];n.isFunction(r)||(r=this[e[t]]);if(!r)continue;var i=t.match(C);this.delegate(i[1],i[2],n.bind(r,this))}return this},delegate:function(e,t,n){this.$el.on(e+".delegateEvents"+this.cid,t,n)},undelegateEvents:function(){return this.$el&&this.$el.off(".delegateEvents"+this.cid),this},undelegate:function(e,t,n){this.$el.off(e+".delegateEvents"+this.cid,t,n)},_createElement:function(e){return document.createElement(e)},_ensureElement:function(){if(!this.el){var e=n.extend({},n.result(this,"attributes"));this.id&&(e.id=n.result(this,"id")),this.className&&(e["class"]=n.result(this,"className")),this.setElement(this._createElement(n.result(this,"tagName"))),this._setAttributes(e)}else this.setElement(n.result(this,"el"))},_setAttributes:function(e){this.$el.attr(e)}}),t.sync=function(e,r,i){var s=L[e];n.defaults(i||(i={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var o={type:s,dataType:"json"};i.url||(o.url=n.result(r,"url")||I()),i.data==null&&r&&(e==="create"||e==="update"||e==="patch")&&(o.contentType="application/json",o.data=JSON.stringify(i.attrs||r.toJSON(i))),i.emulateJSON&&(o.contentType="application/x-www-form-urlencoded",o.data=o.data?{model:o.data}:{});if(i.emulateHTTP&&(s==="PUT"||s==="DELETE"||s==="PATCH")){o.type="POST",i.emulateJSON&&(o.data._method=s);var u=i.beforeSend;i.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",s);if(u)return u.apply(this,arguments)}}o.type!=="GET"&&!i.emulateJSON&&(o.processData=!1);var a=i.error;i.error=function(e,t,n){i.textStatus=t,i.errorThrown=n,a&&a.call(i.context,e,t,n)};var f=i.xhr=t.ajax(n.extend(o,i));return r.trigger("request",r,f,i),f};var L={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var A=t.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},O=/\((.*?)\)/g,M=/(\(\?)?:\w+/g,_=/\*\w+/g,D=/[\-{}\[\]+?.,\\\^$|#\s]/g;n.extend(A.prototype,u,{initialize:function(){},route:function(e,r,i){n.isRegExp(e)||(e=this._routeToRegExp(e)),n.isFunction(r)&&(i=r,r=""),i||(i=this[r]);var s=this;return t.history.route(e,function(n){var o=s._extractParameters(e,n);s.execute(i,o,r)!==!1&&(s.trigger.apply(s,["route:"+r].concat(o)),s.trigger("route",r,o),t.history.trigger("route",s,r,o))}),this},execute:function(e,t,n){e&&e.apply(this,t)},navigate:function(e,n){return t.history.navigate(e,n),this},_bindRoutes:function(){if(!this.routes)return;this.routes=n.result(this,"routes");var e,t=n.keys(this.routes);while((e=t.pop())!=null)this.route(e,this.routes[e])},_routeToRegExp:function(e){return e=e.replace(D,"\\$&").replace(O,"(?:$1)?").replace(M,function(e,t){return t?e:"([^/?]+)"}).replace(_,"([^?]*?)"),new RegExp("^"+e+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(e,t){var r=e.exec(t).slice(1);return n.map(r,function(e,t){return t===r.length-1?e||null:e?decodeURIComponent(e):null})}});var P=t.History=function(){this.handlers=[],n.bindAll(this,"checkUrl"),typeof window!="undefined"&&(this.location=window.location,this.history=window.history)},H=/^[#\/]|\s+$/g,B=/^\/+|\/+$/g,j=/#.*$/;P.started=!1,n.extend(P.prototype,u,{interval:50,atRoot:function(){var e=this.location.pathname.replace(/[^\/]$/,"$&/");return e===this.root&&!this.getSearch()},matchRoot:function(){var e=this.decodeFragment(this.location.pathname),t=e.slice(0,this.root.length-1)+"/";return t===this.root},decodeFragment:function(e){return decodeURI(e.replace(/%25/g,"%2525"))},getSearch:function(){var e=this.location.href.replace(/#.*/,"").match(/\?.+/);return e?e[0]:""},getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getPath:function(){var e=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return e.charAt(0)==="/"?e.slice(1):e},getFragment:function(e){return e==null&&(this._usePushState||!this._wantsHashChange?e=this.getPath():e=this.getHash()),e.replace(H,"")},start:function(e){if(P.started)throw new Error("Backbone.history has already been started");P.started=!0,this.options=n.extend({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._hasHashChange="onhashchange"in window,this._useHashChange=this._wantsHashChange&&this._hasHashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!this.history&&!!this.history.pushState,this._usePushState=this._wantsPushState&&this._hasPushState,this.fragment=this.getFragment(),this.root=("/"+this.root+"/").replace(B,"/");if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var t=this.root.slice(0,-1)||"/";return this.location.replace(t+"#"+this.getPath()),!0}this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){var r=document.createElement("iframe");r.src="javascript:0",r.style.display="none",r.tabIndex=-1;var i=document.body;this.iframe=i.insertBefore(r,i.firstChild).contentWindow,this.iframe.document.open().close(),this.iframe.location.hash="#"+this.fragment}var s=window.addEventListener||function(e,t){return attachEvent("on"+e,t)};this._usePushState?s("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe?s("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval));if(!this.options.silent)return this.loadUrl()},stop:function(){var e=window.removeEventListener||function(e,t){return detachEvent("on"+e,t)};this._usePushState?e("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe&&e("hashchange",this.checkUrl,!1),this.iframe&&(document.body.removeChild(this.iframe.frameElement),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),P.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();t===this.fragment&&this.iframe&&(t=this.getHash(this.iframe));if(t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()},loadUrl:function(e){return this.matchRoot()?(e=this.fragment=this.getFragment(e),n.any(this.handlers,function(t){if(t.route.test(e))return t.callback(e),!0})):!1},navigate:function(e,t){if(!P.started)return!1;if(!t||t===!0)t={trigger:!!t};e=this.getFragment(e||"");var n=this.root;if(e===""||e.charAt(0)==="?")n=n.slice(0,-1)||"/";var r=n+e;e=this.decodeFragment(e.replace(j,""));if(this.fragment===e)return;this.fragment=e;if(this._usePushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,r);else{if(!this._wantsHashChange)return this.location.assign(r);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getHash(this.iframe)&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}if(t.trigger)return this.loadUrl(e)},_updateHash:function(e,t,n){if(n){var r=e.href.replace(/(javascript:|#).*$/,"");e.replace(r+"#"+t)}else e.hash="#"+t}}),t.history=new P;var F=function(e,t){var r=this,i;e&&n.has(e,"constructor")?i=e.constructor:i=function(){return r.apply(this,arguments)},n.extend(i,r,t);var s=function(){this.constructor=i};return s.prototype=r.prototype,i.prototype=new s,e&&n.extend(i.prototype,e),i.__super__=r.prototype,i};y.extend=w.extend=A.extend=N.extend=P.extend=F;var I=function(){throw new Error('A "url" property or function must be specified')},q=function(e,t){var n=t.error;t.error=function(r){n&&n.call(t.context,e,r,t),e.trigger("error",e,r,t)}};return t}),n("js/Models/Breakpoint",["require","exports","module","backbone","underscore"],function(e,t,n){var r=e("backbone"),i=e("underscore");n.exports=r.Model.extend({defaults:{widget:null,sort:null,media:[0,100],span:[1,1],clear:"none",clearOptions:{},mixins:[],mixinOptions:{},customCss:{}},parseData:function(e){var t;t={},t.id=e.id,t.widget=e.widget,e.data.media==="default"&&(t.media="default"),i.isArray(e.data.media)&&(t.media=[e.data.media[0],e.data.media[1]]),t.span=[e.data.span[0],e.data.span[1]],t.clear=e.data.clear,t.sort=e.sort,t.clearOptions=e.clearOptions,t.mixins=e.data.mixins,t.mixinOptions=e.mixinOptions,t.customCss=i.isArray(e.data.customCss)&&!e.data.customCss.length?{}:e.data.customCss,this.set(t)},parsePropertiesString:function(e){var t,n,r,i,s;t={};while(e){n=e.indexOf(":");if(n===-1){e=!1;continue}i=e.substring(0,n).trim(),r=e.indexOf(";",n);if(r===-1){e=!1;continue}s=e.substring(n+1,r).trim(),i&&s&&(t[i]=s),e=e.slice(r+1)}return this.set("customCss",t,{silent:!0}),this.trigger("change change:customCss",this),t},toJSON:function(){var e,t;return e={},e.id=this.get("id"),e.widget=this.get("widget"),e.sort=this.get("sort"),e.clearOptions=this.get("clearOptions"),e.mixinOptions=this.get("mixinOptions"),t={},t.media=this.get("media"),t.span=this.get("span"),t.clear=this.get("clear"),t.mixins=this.get("mixins"),t.customCss=this.get("customCss"),e.data=t,e}})}),n("js/Collections/Breakpoints",["require","exports","module","backbone","js/Models/Breakpoint","underscore"],function(e,t,n){var r=e("backbone"),i=e("js/Models/Breakpoint"),s=e("underscore");n.exports=r.Collection.extend({model:i,parseData:function(e){var t;s(e).each(function(e){t=this.get(e.id);if(t instanceof i&&t.id==e.id)return t.parseData(e);t=new i,t.parseData(e),this.add(t)},this)}})}),n("js/Models/Widget",["require","exports","module","backbone","js/Collections/Breakpoints","underscore"],function(e,t,n){var r=e("backbone"),i=e("js/Collections/Breakpoints"),s=e("underscore");n.exports=r.Model.extend({initialize:function(e){this.set("breakpoints",new i),this._lastString=JSON.stringify(this.toJSON()),this.listenTo(this.get("breakpoints"),"change",this.triggerChange)},triggerChange:function(){this.trigger("change change:breakpoints",this)},defaults:{owner:null,ownerType:null,parent:1,className:"Widget",breakpoints:null,sort:null},parseWidget:function(e){var t;t=JSON.parse(e),this.set("id",t.id),this.set("owner",t.owner),this.set("ownerType",t.ownerType),this.set("parent",t.parent),this.set("className",t.data.className),this.set("sort",t.sort),this.get("breakpoints").parseData(t.breakpoints),this._lastString=JSON.stringify(this.toJSON())},isChanged:function(){return this._lastString!==JSON.stringify(this.toJSON())},toJSON:function(){var e;return e=r.Model.prototype.toJSON.apply(this,arguments),e.breakpoints=e.breakpoints.toJSON(),e},children:function(){return wgts.widgets.filter(function(e){return e.get("parent")===this.get("id")},this)}})}),n("js/Collections/Widgets",["require","exports","module","backbone","js/Models/Widget"],function(e,n,r){var i=t("backbone"),s=t("js/Models/Widget");r.exports=i.Collection.extend({model:s,initialize:function(){this.listenTo(wgts.events,"widgets:update",this.updateWidgets)},updateWidgets:function(e){function r(t){this.parseWidgets(t),wgts.events.trigger("widgets:updated",e)}var t,n;t=[],this.each(function(e){e.isChanged()&&t.push(e.toJSON())}),$.post(wgts.config.ajaxUrl+"Update/",{owner:wgts.config.owner,ownerType:wgts.config.ownerType,widgets:JSON.stringify(t)},_.bind(r,this))},parseWidgets:function(e){var t,n;t=JSON.parse(e),_(t).each(function(e){n=this.get(e.id),n&&n.parseWidget(JSON.stringify(e))},this)}})}),n("text",["module"],function(e){"use strict";var n,r,i,s,o,u=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],a=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,f=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,l=typeof location!="undefined"&&location.href,c=l&&location.protocol&&location.protocol.replace(/\:/,""),h=l&&location.hostname,p=l&&(location.port||undefined),d={},v=e.config&&e.config()||{};n={version:"2.0.14",strip:function(e){if(e){e=e.replace(a,"");var t=e.match(f);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:v.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=u[t];try{e=new ActiveXObject(n)}catch(r){}if(e){u=[n];break}}return e},parseName:function(e){var t,n,r,i=!1,s=e.lastIndexOf("."),o=e.indexOf("./")===0||e.indexOf("../")===0;return s!==-1&&(!o||s>1)?(t=e.substring(0,s),n=e.substring(s+1)):t=e,r=n||t,s=r.indexOf("!"),s!==-1&&(i=r.substring(s+1)==="strip",r=r.substring(0,s),n?n=r:t=r),{moduleName:t,ext:n,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,t,r,i){var s,o,u,a=n.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===t)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,t,r,i){r=t?n.strip(r):r,v.isBuild&&(d[e]=r),i(r)},load:function(e,t,r,i){if(i&&i.isBuild&&!i.inlineText){r();return}v.isBuild=i&&i.isBuild;var s=n.parseName(e),o=s.moduleName+(s.ext?"."+s.ext:""),u=t.toUrl(o),a=v.useXhr||n.useXhr;if(u.indexOf("empty:")===0){r();return}!l||a(u,c,h,p)?n.get(u,function(t){n.finishLoad(e,s.strip,t,r)},function(e){r.error&&r.error(e)}):t([o],function(e){n.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,t,r,i){if(d.hasOwnProperty(t)){var s=n.jsEscape(d[t]);r.asModule(e+"!"+t,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,t,r,i,s){var o=n.parseName(t),u=o.ext?"."+o.ext:"",a=o.moduleName+u,f=r.toUrl(o.moduleName+u)+".js";n.load(a,r,function(t){var r=function(e){return i(f,e)};r.asModule=function(e,t){return i.asModule(e,f,t)},n.write(e,a,r,s)},s)}};if(v.env==="node"||!v.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node&&!process.versions["node-webkit"]&&!process.versions["atom-shell"])r=t.nodeRequire("fs"),n.get=function(e,t,n){try{var i=r.readFileSync(e,"utf8");i[0]==="ï»¿"&&(i=i.substring(1)),t(i)}catch(s){n&&n(s)}};else if(v.env==="xhr"||!v.env&&n.createXhr())n.get=function(e,t,r,i){var s=n.createXhr(),o;s.open("GET",e,!0);if(i)for(o in i)i.hasOwnProperty(o)&&s.setRequestHeader(o.toLowerCase(),i[o]);v.onXhr&&v.onXhr(s,e),s.onreadystatechange=function(n){var i,o;s.readyState===4&&(i=s.status||0,i>399&&i<600?(o=new Error(e+" HTTP status: "+i),o.xhr=s,r&&r(o)):t(s.responseText),v.onXhrComplete&&v.onXhrComplete(s,e))},s.send(null)};else if(v.env==="rhino"||!v.env&&typeof Packages!="undefined"&&typeof java!="undefined")n.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),r!==null&&n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)};else if(v.env==="xpconnect"||!v.env&&typeof Components!="undefined"&&Components.classes&&Components.interfaces)i=Components.classes,s=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),o="@mozilla.org/windows-registry-key;1"in i,n.get=function(e,t){var n,r,u,a={};o&&(e=e.replace(/\//g,"\\")),u=new FileUtils.File(e);try{n=i["@mozilla.org/network/file-input-stream;1"].createInstance(s.nsIFileInputStream),n.init(u,1,0,!1),r=i["@mozilla.org/intl/converter-input-stream;1"].createInstance(s.nsIConverterInputStream),r.init(n,"utf-8",n.available(),s.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),r.readString(n.available(),a),r.close(),n.close(),t(a.value)}catch(f){throw new Error((u&&u.path||"")+": "+f)}};return n}),n("text!js/Templates/Breakpoint.html",[],function(){return'<td class="BreakpointSortWrapper"><i class="fa fa-arrows breakpointSort"></i></td>\n\n<% if (data.media === \'default\') { %>\n  <td>Default</td>\n  <td></td>\n<% } else { %>\n  <td><input class="breakpointMedia breakpointMediaMin" type="text" size="10" value="<%= data.media[0] %>"></td>\n  <td><input class="breakpointMedia breakpointMediaMax" type="text" size="10" value="<%= data.media[1] %>"></td>\n<% } %>\n\n<td>\n  <input class="breakpointSpan breakpointSpanNumerator" type="text" size="2" value="<%= data.span[0] %>">\n    of \n  <input class="breakpointSpan breakpointSpanDenominator" type="text" size="2" value="<%= data.span[1] %>">\n</td>\n\n<td>\n  <select class="breakpointClear">\n    <% _(clearOptions).each(function (option) { %>\n    <option value="<%= option %>" <% if (option === data.clear) { %>selected="selected"<% } %>><%= option %></option>\n    <% }); %>    \n  </select>\n</td>\n<%\n// <td>\n//   <select id="Inputfield_breakpointMixins_<%= widget %>" class="breakpointMixins" multiple="multiple">\n//     <% _(mixinOptions).each(function (label, value) {%>\n//     <option value="<%= value %>"><%= label %></option>\n//     <%}); %>\n//   </select>\n// </td>\n%>\n\n<td><a class=\'customCss\' href=\'#\' data-text-open="Edit" data-text-close="Close">Edit</a></td>\n\n<% if (data.media === \'default\') { %>\n<td></td>\n<% } else { %>\n<td><a class="remove" href="#"><i class="fa fa-trash"></i></a></td>\n<% } %>'}),n("magnificPopup",["require","exports","module"],function(e,t,n){n.exports=$.magnificPopup}),n("js/Views/CustomCssEditor",["require","exports","module","backbone","magnificPopup"],function(e,t,n){var r=e("backbone"),i=e("magnificPopup");n.exports=r.View.extend({events:{'keyup [name="CustomCss"]':"updateProperties"},tagName:"ul",attributes:{"class":"WrapCustomCssEditorFields"},template:function(e){return _(e.data.customCss).reduce(function(e,t,n){return e+n+" : "+t+";\n"},"")},initialize:function(){this.$el.append($("#CustomCssEditorFields").clone().removeClass("InputfieldHidden").attr("id","")),this.$textarea=this.$('[name="CustomCss"]'),this.render()},updateProperties:_.debounce(function(){this.model.parsePropertiesString(this.$textarea.val())},200),show:function(e){this.$el.slideDown(200,e)},hide:function(e){this.model.parsePropertiesString(this.$textarea.val()),this.$el.slideUp(100,e)},render:function(){return this.$textarea.text(this.template(this.model.toJSON())),this}})}),n("js/Views/Breakpoint",["require","exports","module","backbone","text!js/Templates/Breakpoint.html","js/Views/CustomCssEditor","underscore"],function(e,t,n){var r=e("backbone"),i=e("text!js/Templates/Breakpoint.html"),s=e("js/Views/CustomCssEditor"),o=e("underscore");n.exports=r.View.extend({events:{"click .remove":"fadeRemove","keyup .breakpointMediaMin":"updateMediaMin","keyup .breakpointMediaMax":"updateMediaMax","keyup .breakpointSpanNumerator":"updateSpanNumerator","keyup .breakpointSpanDenominator":"updateSpanDenominator","click .customCss":"handleCssEditor","change .breakpointClear":"updateClear"},attributes:function(){return{id:this.model.id,role:"row"}},tagName:"tr",template:o.template(i),initialize:function(e){this._customCss=null},updateMediaMin:function(e){var t;t=parseInt($(e.target).val(),10),this.model.set("media",[t,this.model.get("media")[1]])},updateMediaMax:function(e){var t;t=parseInt($(e.target).val(),10),this.model.set("media",[this.model.get("media")[0],t])},updateSpanNumerator:function(e){var t;t=parseInt($(e.target).val(),10),this.model.set("span",[t,this.model.get("span")[1]])},updateSpanDenominator:function(e){var t;t=parseInt($(e.target).val(),10),this.model.set("span",[this.model.get("span")[0],t])},updateClear:function(e){this.model.set("clear",$(e.target).val())},fadeRemove:function(e){e.preventDefault(),wgts.events.trigger("remove:breakpoint",this)},remove:function(){function e(){r.View.prototype.remove.apply(this)}this.$el.fadeOut(200,o.bind(e,this))},handleCssEditor:function(e){var t;t=$(e.target),e.preventDefault();if(!t.is(".customCss"))return;this._customCss===null?this.launchCustomCssEditor():this.closeCustomCssEditor()},launchCustomCssEditor:function(){var e;e=this.$(".customCss"),e.text(e.attr("data-text-close")),this._customCss=new s({model:this.model}),this._customCss.$el.insertAfter(this.$(".customCss")),this._customCss.show()},closeCustomCssEditor:function(){var e;e=this.$(".customCss"),e.text(e.attr("data-text-open")),this._customCss.hide(o.bind(this._customCss.remove,this._customCss)),this._customCss=null},render:function(){return this.$el.empty().append(this.template(this.model.toJSON())),this}})}),n("js/Views/Breakpoints",["require","exports","module","backbone","js/Views/Breakpoint","js/Models/Breakpoint","underscore"],function(e,t,n){var r=e("backbone"),i=e("js/Views/Breakpoint"),s=e("js/Models/Breakpoint"),o=e("underscore");n.exports=r.View.extend({events:{"click .addBreakpointButton":"addBreakpoint"},initialize:function(e){var t;this.$breakpoints=this.$("tbody"),this.$spinner=$('<i class="fa fa-lg fa-spin fa-spinner"></i>'),this._breakpoints=[],this.populate(),this.attachEvents()},attachEvents:function(){this.listenTo(this.collection,"add",this.renderBreakpoint),this.listenTo(this.collection,"reset",this.populate),this.listenTo(wgts.events,"remove:breakpoint",this.removeBreakpoint),this.$breakpoints.sortable({handle:".BreakpointSortWrapper",axis:"y",cursor:"move",update:o.bind(this.onSortUpdate,this)})},onSortUpdate:function(e,t){o(this.$breakpoints.children()).each(function(e,t){this.collection.get(parseInt($(e).attr("id"),10)).set("sort",t)},this)},removeBreakpoint:function(e){function n(n){n=wgts.messenger(n),n&&(this._breakpoints.splice(t,1),this.collection.remove(e.model),e.remove(),this.stopSpinning())}var t;t=o(this._breakpoints).findIndex(function(t){return t.cid===e.cid});if(t===-1)return;this.startSpinning(),$.get(wgts.config.ajaxUrl+"DeleteBreakpoint/",{id:e.model.id},o.bind(n,this))},populate:function(){this._breakpoints=this.collection.map(function(e){return new i({model:e})},this),this.renderBreakpoints()},addBreakpoint:function(e){function t(e){var t;t=new s,t.parseData(JSON.parse(e)),this.collection.add(t),this.stopSpinning()}e.preventDefault(),this.startSpinning(),$.get(wgts.config.ajaxUrl+"CreateBreakpoint/",{widgetId:this.model.id},o.bind(t,this))},renderBreakpoint:function(e){var t;t=new i({model:e}),this._breakpoints.push(t),this.$breakpoints.append(t.render().el)},renderBreakpoints:function(){var e;return e=document.createDocumentFragment(),o(this._breakpoints).each(function(t,n){e.appendChild(t.render().el)},this),this.$breakpoints.empty().append(e),this},startSpinning:function(){this.$(".InputfieldWidgetHeader").append(this.$spinner)},stopSpinning:function(){this.$spinner.remove()}})}),n("js/Config",["require","exports","module","underscore"],function(e,t,n){var r=e("underscore");n.exports=r.extend(config.ProcessWidgets,{ajaxUrl:config.urls.admin+"setup/widgets/",status:{start:"start",progress:"progress",end:"end",changed:"changed",unchanged:"unchanged",ready:"ready"}})}),n("js/Views/WidgetChangeParent",["require","exports","module","backbone","js/Config","underscore"],function(e,t,n){var r=e("backbone"),i=e("js/Config"),s=e("underscore"),o=i.status;n.exports=r.View.extend({events:{"click .link":"toggleChangeParent"},initialize:function(e){this.$a=this.$('[name="changeParent"]'),this.$message=this.$(".message"),this._changeText=this.$a.attr("data-change-str"),this._unchangeText=this.$a.attr("data-unchange-str"),wgts._changeParentStatus=o.ready,this.listenTo(wgts.events,"widget:changeParent widget:unchangeParent widget:changedParent",this.toggleChangeParentText),this._parent=e._parent},toggleChangeParent:function(e){e.preventDefault(),wgts._changeParentStatus===o.ready?this.changeParent():this.unchangeParent()},changeParent:function(){wgts._changeParentStatus=o.progress,wgts._changeParentWidget=this._parent,wgts.events.trigger("widget:changeParent",this._parent)},unchangeParent:function(){wgts._changeParentStatus=o.ready,wgts._changeParentWidget=null,wgts.events.trigger("widget:unchangeParent",this._parent)},toggleChangeParentText:function(e){if(e.model.id!==this.model.id)return;wgts._changeParentStatus===o.progress?(this.$a.empty().append(this._unchangeText),this.$message.fadeIn(200)):(this.$a.empty().append(this._changeText),this.$message.fadeOut(200))}})}),n("js/Views/Widget",["require","exports","module","backbone","js/Views/Breakpoints","js/Models/Breakpoint","js/Views/WidgetChangeParent","js/Models/Widget","magnificPopup","js/Config","underscore"],function(e,t,n){var r=e("backbone"),i=e("js/Views/Breakpoints"),s=e("js/Models/Breakpoint"),o=e("js/Views/WidgetChangeParent"),u=e("js/Models/Widget"),a=e("magnificPopup"),f=e("js/Config"),l=e("underscore"),c=f.status;n.exports=r.View.extend({events:{"click .InputfieldWidgetDelete":"remove",'change [name="widgetType"]':"changeType"},initialize:function(e){var t,n,r;this.$(".InputfieldHeader").addClass("InputfieldStateToggle"),this.model=new u,t=this.$el.attr("data-id"),n=this.$("#Inputfield_"+t).val(),this.model.parseWidget(n),this.breakpoints=new i({model:this.model,collection:this.model.get("breakpoints"),el:this.$("#wrap_InputfieldBreakpoints_"+this.model.id)[0]}),this.$spinner=$('<i class="fa fa-lg fa-spin fa-spinner"></i>'),this.$labelMeta=this.$(".InputfieldWidgetHeader .InputfieldWidgetHeaderMeta"),r=this.$("#wrap_Inputfield_widgets_"+this.model.id),r.length&&wgts.addContainer(r[0]),this.changeParent=new o({el:this.$("#wrap_changeParent_"+this.model.id),model:this.model,_parent:this}),this.attachEvents()},attachEvents:function(){this.$("#widgetSettings_"+this.model.id).magnificPopup({type:"iframe",callbacks:{close:l.bind(this.updateLabelMeta,this)}})},addBreakpoint:function(e){e.preventDefault(),this.model.get("breakpoints").add(new s)},alertChildren:function(){alert("Please remove embedded (child) widgets first.")},remove:function(e){function t(e){e=wgts.messenger(e),e&&(wgts.events.trigger("remove:widget",this),this.stopSpinning(),this.$el.slideUp(l.bind(r.View.prototype.remove,this)))}return e.preventDefault(),this.model.children().length?this.alertChildren():(this.startSpinning(),$.get(wgts.config.ajaxUrl+"Delete/",{widgetId:this.model.id},l.bind(t,this)),!1)},changeType:function(e){var t;t=$(e.target);if(!t.is("#widgetType_"+this.model.id))return;this.model.set("className",$(e.target).val()),wgts.events.trigger("widget:changeType",this),this.startSpinning()},startSpinning:function(){this.$(".InputfieldWidgetHeader").append(this.$spinner)},stopSpinning:function(){this.$spinner.remove()},updateLabelMeta:function(){function e(e){this.$labelMeta.empty().append(e)}$.get(wgts.config.ajaxUrl+"LabelMeta/",{widgetId:this.model.id},l.bind(e,this))}})}),n("js/Views/Widgets",["require","exports","module","backbone","js/Views/Widget","js/Config","underscore"],function(e,t,n){var r=e("backbone"),i=e("js/Views/Widget"),s=e("js/Config"),o=e("underscore"),u=s.status;n.exports=r.View.extend({events:{"click .InputfieldWidgetsAddLink":"addWidget"},initialize:function(e){this._id=parseInt(this.$el.attr("id").replace("wrap_Inputfield_widgets_",""),10),this.$widgets=this.$(".Inputfields.InputfieldsWidgets_"+this._id),this._widgets=o(this.$widgets.children(".InputfieldWidget")).map(this.initializeWidget,this),this.$addLink=this.$("#InputfieldWidgetsAddLink_"+this._id),this._addLinkText=this.$addLink.text(),this.attachEvents()},initializeWidget:function(e){var t;return t=new i({el:e}),wgts.widgets.add(t.model),t},attachEvents:function(){this.listenTo(wgts.events,"remove:widget",this.removeWidget),this.listenTo(wgts.events,"widget:changeType",this.changeWidgetType),this.listenTo(wgts.events,"widget:changeParent",this.onChangeParent),this.listenTo(wgts.events,"widget:unchangeParent widget:changedParent",this.unchangeParent),this.listenTo(wgts.events,"widget:moveToParent",this.removeChild),this.$widgets.sortable({handle:".InputfieldWidgetDragZone",axis:"y",cursor:"move",distance:8,opacity:.65,update:o.bind(this.onSortUpdate,this)})},addWidget:function(e){var t;t=$(e.target),id="#InputfieldWidgetsAddLink_"+this._id;if(!t.is(id)&&!t.parents(id).length)return;e.preventDefault();if(wgts._changeParentStatus===u.progress&&wgts._changeParentWidget instanceof i){if(this.isChild(wgts._changeParentWidget))return;return this.changeParent()}$.get(wgts.config.ajaxUrl+"Create/",{owner:wgts.config.owner,ownerType:wgts.config.ownerType,parent:this._id},o.bind(this.onDataRecieve,this))},onDataRecieve:function(e){$data=$(e),$data.css("display","none"),$data.length===1?(this.$widgets.append($data),this._widgets.push(this.initializeWidget($data[0])),$data.slideDown()):$data.length>1&&o($data).each(function(e){this.onDataRecieve(e)},this)},changeWidgetType:function(e){function i(i){n=$(i),n.insertAfter(e.$el),r.View.prototype.remove.apply(e),wgts.widgets.remove(e.model),this._widgets.splice(t,1),this._widgets.push(this.initializeWidget(n[0]))}var t,n;t=o(this._widgets).findIndex(function(t){return t.cid===e.cid&&t.model.id===e.model.id});if(t===-1)return;$.post(wgts.config.ajaxUrl+"ChangeType/",{widget:JSON.stringify(e.model.toJSON())},o.bind(i,this))},removeWidget:function(e){var t,e;t=o(this._widgets).findIndex(function(t){return t.cid===e.cid});if(t===-1)return;this._widgets.splice(t,1),wgts.widgets.remove(e.model)},onSortUpdate:function(e,t){o(this.$widgets.children()).each(function(e,t){wgts.widgets.get(parseInt($(e).attr("data-id"),10)).set("sort",t)})},isChild:function(e){return o(this._widgets).some(function(t){return t.model.id===e.model.id})},onChangeParent:function(e){if(this.isChild(e)||this._id===e.model.id)return;this.$addLink.empty().append(wgts.config.changeParentDestinationText)},changeParent:function(){function t(){e.$el.appendTo(this.$widgets),this._widgets.push(e),e.$el.slideDown(300),wgts._changeParentStatus=u.ready,wgts._changeParentWidget=null,wgts.events.trigger("widget:changedParent",e)}var e;e=wgts._changeParentWidget,e.model.set("parent",this._id),e.$el.slideUp(300,o.bind(t,this)),wgts.events.trigger("widget:moveToParent",e)},unchangeParent:function(){this.$addLink.empty().append(this._addLinkText)},removeChild:function(e){var t;if(!this.isChild(e))return;t=o(this._widgets).findIndex(function(t){return e.model.id===t.model.id}),this._widgets.splice(t,1)}})}),n("js/Views/WidgetsUpdate",["require","exports","module","backbone","js/Config","underscore"],function(e,t,n){var r=e("backbone"),i=e("js/Config"),s=e("underscore"),o=i.status;n.exports=r.View.extend({events:{"click button":"update"},initialize:function(){this.$button=this.$("button"),this.$spinner=$('<i class="fa fa-lg fa-spin fa-spinner"></i>'),this.$text=this.$(".ui-button-text"),this._status=o.end,this._buttonSizeFixed=!1,this.attachEvents(),this._disabled=!0,this.updateButtonStatus()},attachEvents:function(){this.listenTo(wgts.events,"widgets:updated",this.updated),this.listenTo(wgts.widgets,"change",this.updateButtonStatus)},update:function(e){e.preventDefault();if(this._disabled)return;this.fixButtonSize(),wgts.events.trigger("widgets:update"),this.startSpinning()},defaultMode:function(){this.$button.removeClass("ui-state-active").addClass("ui-state-default")},updated:function(e,t){this.stopSpinning(),this.defaultMode(),this.updateButtonStatus(),this._status=o.end},fixButtonSize:function(){if(this._buttonSizeFixed)return;this.$button.css("width",this.$el.width()+"px"),this._buttonSizeFixed=!0},startSpinning:function(){this.$button.empty().append(this.$spinner)},stopSpinning:function(){this.$button.empty().append(this.$text),this.updateButtonStatus()},updateButtonStatus:function(){var e;e=wgts.widgets.some(function(e){return e.isChanged()}),e?this.enableButton():this.disableButton()},enableButton:function(){this.$button.removeClass("ui-state-disabled"),this._disabled=!1},disableButton:function(){this.$button.addClass("ui-state-disabled"),this._disabled=!0}})}),n("js/Views/CloneWidgets",["require","exports","module","backbone","js/Config","underscore"],function(e,t,n){var r=e("backbone"),i=e("js/Config"),s=e("underscore"),o=i.status;n.exports=r.View.extend({el:"#wrap_Inputfield_widgets_clone_template",events:{"click button":"cloneWidgets"},initialize:function(){this.$button=this.$("button"),this.$spinner=$('<i class="fa fa-lg fa-spin fa-spinner"></i>'),this.$text=this.$(".ui-button-text"),this._status=o.end,this._buttonSizeFixed=!1,this._disabled=!1,this.attachEvents()},attachEvents:function(){this.listenTo(wgts.widgets,"add remove",this.onWidgetsChange)},hide:function(e){this.$el.slideUp(e),this._disabled=!0},show:function(e){this.$el.slideDown(e),this._disabled=!1},onWidgetsChange:function(e){wgts.widgets.length?this.hide():this.show()},getRootContainer:function(){return s(wgts.containers).find(function(e){return e.$el.is("#wrap_Inputfield_widgets_1")},this)},cloneWidgets:function(e){e.preventDefault();if(this._status!==o.end)return;if(wgts.widgets.length)return;if(this._disabled)return;this._status=o.progress,this.fixButtonSize(),this.startSpinning(),$.get(wgts.config.ajaxUrl+"CloneWidgets/",{cloneFrom:wgts.config.cloneFrom,cloneTo:wgts.config.cloneTo},s.bind(this.onDataRecieve,this))},onDataRecieve:function(e){if(this._status!==o.progress)return;this._status=o.end,this.getRootContainer().onDataRecieve(e),this.stopSpinning()},fixButtonSize:function(){if(this._buttonSizeFixed)return;this.$button.css("width",this.$button.outerWidth()+2+"px"),this._buttonSizeFixed=!0},startSpinning:function(){this.$button.empty().append(this.$spinner)},stopSpinning:function(){this.$button.empty().append(this.$text),this.$button.removeClass("ui-state-active")}})}),n("js/App/App",["require","exports","module","backbone","js/Collections/Widgets","js/Views/Widgets","js/Config","js/Views/WidgetsUpdate","js/Views/CloneWidgets","underscore"],function(e,t,n){var r=e("backbone"),i=e("js/Collections/Widgets"),s=e("js/Views/Widgets"),o=e("js/Config"),u=e("js/Views/WidgetsUpdate"),a=e("js/Views/CloneWidgets"),f=e("underscore");n.exports={_changeParentWidget:null,events:f.extend({},r.Events),launch:function(){var e;window.wgts=this,e=$("#wrap_Inputfield_widgets_1"),wgts.config=o,wgts.widgets=new i,wgts.containers=[],e.length&&wgts.addContainer(e[0]),wgts.batchUpdate=new u({el:$("#wrap_WidgetsBatchUpdate")[0]}),$("#wrap_Inputfield_widgets_clone_template").length&&(wgts.cloner=new a)},addContainer:function(e){wgts.containers.push(new s({el:e}))},messenger:function(e){var t,n;n=!1,t="Something went wrong. Please try to refresh the page and try again.";try{e=JSON.parse(e)}catch(r){return n=!0,alert(t),!1}return e.error!==!1&&!n?(e.message?alert(e.message):alert(t),!1):e}}}),e.config({baseUrl:"/site/modules/Widgets/",paths:{requirejs:"deps/requirejs/require",text:"deps/requirejs-text/text",jquery:"../../../wire/modules/Jquery/JqueryCore/jquery-1.11.1",jqueryUI:"../../../wire/modules/Jquery/jqueryUI/jqueryUI",underscore:"deps/underscore/underscore",backbone:"deps/backbone/backbone",magnificPopup:"../../../wire/modules/Jquery/JqueryMagnific/JqueryMagnific",asmSelect:"../../../wire/modules/Inputfield/InputfieldAsmSelect/asmselect/jquery.asmselect"},shim:{magnificPopup:{deps:["jquery"],exports:"magnificPopup"},jqueryUI:{deps:["jquery"],exports:"jqueryUI"},asmSelect:{deps:["jquery"],exports:"asmSelect"}},waitSeconds:0}),n("js/Boot",["require","exports","module","js/polyfills","jquery","jqueryUI","underscore","backbone","js/App/App","js/Config"],function(e,t,n){e("js/polyfills"),e("jquery"),e("jqueryUI"),e("underscore"),e("backbone");var r=e("js/App/App"),i=e("js/Config");if(i.stop)return;setTimeout(function(){r.launch()},2e3)}),t(["js/Boot"])})();